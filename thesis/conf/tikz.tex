\usepackage{varwidth}
\usepackage{pgf}

\usetikzlibrary{positioning, arrows, decorations.markings}
\usetikzlibrary{shapes}

\tikzset{%label colors for port states
    port/.style={draw, circle},
    dedicated/.style={port, fill=blue!80},
    root/.style={port, fill=green},
    blocking/.style={port, fill=red}
}

\newcommand{\switch}[2]{
    \scalebox{#1}{
        \begin{tikzpicture}
            \node at (0,0) {\includegraphics{switch.pdf}};
            \node at (0,-0.6) {#2};
        \end{tikzpicture}
    }
}

\definecolor{bottomcol}{RGB}{222,222,222}
\tikzstyle{class}=[
    rectangle,
    draw=black,
    anchor=north,
    text=black,
    text width=3cm,
    shading=axis,
    bottom color=bottomcol,top color=white,shading angle=45,
    execute at begin node={\begin{varwidth}{15em}},
    execute at end node={\end{varwidth}}
]

\usepackage{pgfplots}

% Code from Christian Feuers√§nger
% http://tex.stackexchange.com/questions/54794/using-a-pgfplots-style-legend-in-a-plain-old-tikzpicture#54834

% argument #1: any options
\newenvironment{customlegend}[1][]{%
    \begingroup
    % inits/clears the lists (which might be populated from previous
    % axes):
    \csname pgfplots@init@cleared@structures\endcsname
    \pgfplotsset{#1}%
}{%
    % draws the legend:
    \csname pgfplots@createlegend\endcsname
    \endgroup
}%

% makes \addlegendimage available (typically only available within an
% axis environment):
\def\addlegendimage{\csname pgfplots@addlegendimage\endcsname}
